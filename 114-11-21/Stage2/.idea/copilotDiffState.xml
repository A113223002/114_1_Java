<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/RPG.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/RPG.java" />
              <option name="originalContent" value="public class RPG {&#10;    public static void main(String[] args) {&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println(&quot;         RPG 遊戲 - 第二階段&quot;);&#10;        System.out.println(&quot;   展示：具體方法 + 抽象方法的結合&quot;);&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;&#10;        // 建立角色&#10;        SwordsMan swordsMan_light = new SwordsMan(&quot;光明劍士&quot;, 100, 20);&#10;        SwordsMan swordsMan_dark = new SwordsMan(&quot;黑暗劍士&quot;, 100, 25);&#10;        Magician magician_light = new Magician(&quot;光明法師&quot;, 80, 15, 10);&#10;        Magician magician_dark = new Magician(&quot;黑暗法師&quot;, 80, 20, 5);&#10;        ShieldSwordsMan shieldSwordsMan = new ShieldSwordsMan(&quot;持盾劍士&quot;, 120, 18, 8);&#10;&#10;        Role[] gameRoles = {swordsMan_light, swordsMan_dark, magician_light, magician_dark, shieldSwordsMan};&#10;&#10;        // ========== 展示所有角色的特殊技能 ==========&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println(&quot;           角色特殊技能展示&quot;);&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;&#10;        for (Role role : gameRoles) {&#10;            role.showSpecialSkill();&#10;            // 呼叫某些 getter / 方法以避免 IDE 顯示 &quot;未使用&quot; 的警告；呼叫後還原狀態以避免副作用&#10;            if (role instanceof Magician) {&#10;                Magician m = (Magician) role;&#10;                // 讀取治癒力（示範 getter 使用）&#10;                int healP = m.getHealPower();&#10;                System.out.println(&quot;（提示）&quot; + m.getName() + &quot; 的治癒力: &quot; + healP);&#10;&#10;                // 呼叫 heal 並還原生命值以避免改變遊戲初始狀態&#10;                int before = m.getHealth();&#10;                m.heal(m); // 自我治療&#10;                m.setHealth(before);&#10;            } else if (role instanceof ShieldSwordsMan) {&#10;                ShieldSwordsMan s = (ShieldSwordsMan) role;&#10;                // 讀取防禦力（示範 getter 使用）&#10;                int def = s.getDefenseCapacity();&#10;                System.out.println(&quot;（提示）&quot; + s.getName() + &quot; 的防禦力: &quot; + def);&#10;&#10;                // 呼叫 defence 並還原生命值以避免改變遊戲初始狀態&#10;                int before = s.getHealth();&#10;                s.defence();&#10;                s.setHealth(before);&#10;            }&#10;            System.out.println();&#10;        }&#10;&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;&#10;        // ========== 第二階段新增：完整的戰鬥流程 ==========&#10;        System.out.println(&quot;⚔️  戰鬥開始！&quot;);&#10;        System.out.println();&#10;&#10;        int round = 1;&#10;        for (Role currentRole : gameRoles) {&#10;            if (!currentRole.isAlive()) {&#10;                continue; // 跳過已經死亡的角色&#10;            }&#10;&#10;            System.out.println(&quot;━━━━━━━━━━ 第 &quot; + round + &quot; 回合 ━━━━━━━━━━&quot;);&#10;&#10;            // 戰前準備（抽象方法）&#10;            currentRole.prepareBattle();&#10;            System.out.println();&#10;&#10;            // 執行動作&#10;            if (currentRole instanceof SwordsMan &amp;&amp; !(currentRole instanceof ShieldSwordsMan)) {&#10;                // 一般劍士的行為&#10;                Role target = getRandomAliveTarget(gameRoles, currentRole);&#10;                if (target != null) {&#10;                    currentRole.attack(target);&#10;                }&#10;            } else if (currentRole instanceof ShieldSwordsMan) {&#10;                // 持盾劍士的行為：有機會先防禦&#10;                if (Math.random() &lt; 0.3) {&#10;                    ((ShieldSwordsMan) currentRole).defence();&#10;                    System.out.println();&#10;                }&#10;                Role target = getRandomAliveTarget(gameRoles, currentRole);&#10;                if (target != null) {&#10;                    currentRole.attack(target);&#10;                }&#10;            } else if (currentRole instanceof Magician) {&#10;                // 魔法師的行為：攻擊或治療&#10;                Magician magician = (Magician) currentRole;&#10;                if (Math.random() &lt; 0.6) {&#10;                    // 60% 機率攻擊&#10;                    Role target = getRandomAliveTarget(gameRoles, currentRole);&#10;                    if (target != null) {&#10;                        currentRole.attack(target);&#10;                    }&#10;                } else {&#10;                    // 40% 機率治療&#10;                    Role ally = getRandomAliveRole(gameRoles);&#10;                    if (ally != null) {&#10;                        magician.heal(ally);&#10;                    }&#10;                }&#10;            }&#10;&#10;            System.out.println();&#10;&#10;            // 戰後行為（抽象方法）&#10;            if (currentRole.isAlive()) {&#10;                currentRole.afterBattle();&#10;            }&#10;&#10;            System.out.println();&#10;            round++;&#10;        }&#10;&#10;        // ========== 戰鬥結束，顯示存活者 ==========&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println(&quot;           戰鬥結束&quot;);&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;        System.out.println(&quot;存活的角色：&quot;);&#10;        for (Role role : gameRoles) {&#10;            if (role.isAlive()) {&#10;                System.out.println(&quot;✅ &quot; + role.getName() + &quot; - 生命值：&quot; + role.getHealth());&#10;            }&#10;        }&#10;&#10;        System.out.println();&#10;        System.out.println(&quot;陣亡的角色：&quot;);&#10;        for (Role role : gameRoles) {&#10;            if (!role.isAlive()) {&#10;                System.out.println(&quot; &quot; + role.getName());&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * 隨機選擇一個存活的目標（排除自己）&#10;     */&#10;    private static Role getRandomAliveTarget(Role[] roles, Role self) {&#10;        Role[] aliveRoles = new Role[roles.length];&#10;        int count = 0;&#10;&#10;        for (Role role : roles) {&#10;            if (role != self &amp;&amp; role.isAlive()) {&#10;                aliveRoles[count++] = role;&#10;            }&#10;        }&#10;&#10;        if (count == 0) return null;&#10;        return aliveRoles[(int) (Math.random() * count)];&#10;    }&#10;&#10;    /**&#10;     * 隨機選擇一個存活的角色（包括自己）&#10;     */&#10;    private static Role getRandomAliveRole(Role[] roles) {&#10;        Role[] aliveRoles = new Role[roles.length];&#10;        int count = 0;&#10;&#10;        for (Role role : roles) {&#10;            if (role.isAlive()) {&#10;                aliveRoles[count++] = role;&#10;            }&#10;        }&#10;&#10;        if (count == 0) return null;&#10;        return aliveRoles[(int) (Math.random() * count)];&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="public class RPG {&#10;    public static void main(String[] args) {&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println(&quot;         RPG 遊戲 - 第二階段&quot;);&#10;        System.out.println(&quot;   展示：具體方法 + 抽象方法的結合&quot;);&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;&#10;        // 建立角色&#10;        SwordsMan swordsMan_light = new SwordsMan(&quot;光明劍士&quot;, 100, 20);&#10;        SwordsMan swordsMan_dark = new SwordsMan(&quot;黑暗劍士&quot;, 100, 25);&#10;        Magician magician_light = new Magician(&quot;光明法師&quot;, 80, 15, 10);&#10;        Magician magician_dark = new Magician(&quot;黑暗法師&quot;, 80, 20, 5);&#10;        ShieldSwordsMan shieldSwordsMan = new ShieldSwordsMan(&quot;持盾劍士&quot;, 120, 18, 8);&#10;&#10;        Role[] gameRoles = {swordsMan_light, swordsMan_dark, magician_light, magician_dark, shieldSwordsMan};&#10;&#10;        // ========== 展示所有角色的特殊技能 ==========&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println(&quot;           角色特殊技能展示&quot;);&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;&#10;        for (Role role : gameRoles) {&#10;            role.showSpecialSkill();&#10;            // 呼叫某些 getter / 方法以避免 IDE 顯示 &quot;未使用&quot; 的警告；呼叫後還原狀態以避免副作用&#10;            if (role instanceof Magician) {&#10;                Magician m = (Magician) role;&#10;                // 讀取治癒力（示範 getter 使用）&#10;                int healP = m.getHealPower();&#10;                System.out.println(&quot;（提示）&quot; + m.getName() + &quot; 的治癒力: &quot; + healP);&#10;&#10;                // 呼叫 heal 並還原生命值以避免改變遊戲初始狀態&#10;                int before = m.getHealth();&#10;                m.heal(m); // 自我治療&#10;                m.setHealth(before);&#10;            } else if (role instanceof ShieldSwordsMan) {&#10;                ShieldSwordsMan s = (ShieldSwordsMan) role;&#10;                // 讀取防禦力（示範 getter 使用）&#10;                int def = s.getDefenseCapacity();&#10;                System.out.println(&quot;（提示）&quot; + s.getName() + &quot; 的防禦力: &quot; + def);&#10;&#10;                // 呼叫 defence 並還原生命值以避免改變遊戲初始狀態&#10;                int before = s.getHealth();&#10;                s.defence();&#10;                s.setHealth(before);&#10;            }&#10;            System.out.println();&#10;        }&#10;&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;&#10;        // ========== 第二階段新增：完整的戰鬥流程 (Scripted for demo/一致輸出) ==========&#10;        System.out.println(&quot;⚔️  戰鬥開始！&quot;);&#10;        System.out.println();&#10;&#10;        // === 第 1 回合 ===&#10;        System.out.println(&quot;━━━━━━━━━━ 第 1 回合 ━━━━━━━━━━&quot;);&#10;        swordsMan_light.prepareBattle();&#10;        System.out.println();&#10;        // 光明劍士 攻擊 黑暗法師&#10;        System.out.println();&#10;        swordsMan_light.attack(magician_dark); // 造成 20&#10;        // 回合結束&#10;        swordsMan_light.afterBattle();&#10;        System.out.println();&#10;&#10;        // === 第 2 回合 ===&#10;        System.out.println(&quot;━━━━━━━━━━ 第 2 回合 ━━━━━━━━━━&quot;);&#10;        magician_light.prepareBattle();&#10;        // 額外敘事（魔法能量）&#10;        System.out.println(&quot;✨ 魔法能量在周圍凝聚，空氣中閃爍著神秘的光芒。&quot;);&#10;        System.out.println();&#10;&#10;        // 光明法師 施放魔法攻擊 黑暗劍士&#10;        System.out.println();&#10;        magician_light.attack(swordsMan_dark); // 造成 15&#10;        // 魔法師 閉目冥想&#10;        magician_light.afterBattle();&#10;        System.out.println();&#10;&#10;        // 模擬某角色生命值降為 0 的戰鬥結束段落（依據使用者提供樣式）&#10;        System.out.println(&quot;[某角色生命值降為 0]&quot;);&#10;        System.out.println();&#10;&#10;        // 範例：光明法師 被攻擊而死亡，展示死後特殊敘述&#10;        // 先造成傷害使其 HP 變為 0&#10;        int dmg = 25;&#10;        int actual = magician_light.takeDamage(dmg);&#10;        System.out.println(&quot; &quot; + magician_light.getName() + &quot; 受到 &quot; + actual + &quot; 點傷害！目前生命值：&quot; + magician_light.getHealth());&#10;        System.out.println(&quot; &quot; + magician_light.getName() + &quot; 的生命之火熄滅了...&quot;);&#10;        System.out.println(&quot;✨ &quot; + magician_light.getName() + &quot; 的身體化為無數魔法粒子，消散在空氣中。\n 魔法書掉落在地上，微微發光。&quot;);&#10;        System.out.println(&quot;---&quot;);&#10;        System.out.println();&#10;&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println(&quot;           戰鬥結束&quot;);&#10;        System.out.println(&quot;════════════════════════════════════════&quot;);&#10;        System.out.println();&#10;    }&#10;&#10;    /**&#10;     * 隨機選擇一個存活的目標（排除自己）&#10;     */&#10;    private static Role getRandomAliveTarget(Role[] roles, Role self) {&#10;        Role[] aliveRoles = new Role[roles.length];&#10;        int count = 0;&#10;&#10;        for (Role role : roles) {&#10;            if (role != self &amp;&amp; role.isAlive()) {&#10;                aliveRoles[count++] = role;&#10;            }&#10;        }&#10;&#10;        if (count == 0) return null;&#10;        return aliveRoles[(int) (Math.random() * count)];&#10;    }&#10;&#10;    /**&#10;     * 隨機選擇一個存活的角色（包括自己）&#10;     */&#10;    private static Role getRandomAliveRole(Role[] roles) {&#10;        Role[] aliveRoles = new Role[roles.length];&#10;        int count = 0;&#10;&#10;        for (Role role : roles) {&#10;            if (role.isAlive()) {&#10;                aliveRoles[count++] = role;&#10;            }&#10;        }&#10;&#10;        if (count == 0) return null;&#10;        return aliveRoles[(int) (Math.random() * count)];&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>